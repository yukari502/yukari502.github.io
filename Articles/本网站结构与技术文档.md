# æœ¬ç½‘ç«™ç»“æ„ä¸æŠ€æœ¯æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° **Yukari502.github.io** çš„å®Œæ•´æ¶æ„ã€å·¥ä½œæµã€æ ¸å¿ƒç»„ä»¶åŠç»´æŠ¤æŒ‡å—ã€‚

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
3. [ç›®å½•ç»“æ„](#3-ç›®å½•ç»“æ„)
4. [å·¥ä½œæµç¨‹](#4-å·¥ä½œæµç¨‹)
5. [æ ¸å¿ƒè„šæœ¬ä¸é…ç½®è¯¦è§£](#5-æ ¸å¿ƒè„šæœ¬ä¸é…ç½®è¯¦è§£)
6. [å‰ç«¯æ¶æ„](#6-å‰ç«¯æ¶æ„)
7. [å›¾ç‰‡è·¯å¾„è§£ææœºåˆ¶](#7-å›¾ç‰‡è·¯å¾„è§£ææœºåˆ¶)
8. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#8-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
9. [ç»´æŠ¤æŒ‡å—](#9-ç»´æŠ¤æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **GitHub Pages** æ‰˜ç®¡çš„é™æ€åšå®¢ç³»ç»Ÿï¼Œé‡‡ç”¨æ··åˆæ¸²æŸ“ç­–ç•¥ï¼š
- **æ„å»ºæ—¶å¤„ç†**ï¼šPython è„šæœ¬ç”Ÿæˆé™æ€ HTML é¡µé¢
- **è¿è¡Œæ—¶æ¸²æŸ“**ï¼šå®¢æˆ·ç«¯ JavaScript å°†åµŒå…¥çš„ Markdown è½¬æ¢ä¸º HTML

### æ ¸å¿ƒç‰¹æ€§

- âœ… **è‡ªåŠ¨åŒ–æ„å»º**ï¼šé€šè¿‡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²
- âœ… **Markdown å†™ä½œ**ï¼šæ”¯æŒå‰ç½®å…ƒæ•°æ®ï¼ˆFrontmatterï¼‰
- âœ… **å®¢æˆ·ç«¯æ¸²æŸ“**ï¼šä½¿ç”¨ `marked.js` è§£æ Markdown
- âœ… **ä»£ç é«˜äº®**ï¼šä½¿ç”¨ `highlight.js` + è‡ªå®šä¹‰ macOS é£æ ¼çª—å£
- âœ… **æ•°å­¦å…¬å¼**ï¼šä½¿ç”¨ `KaTeX` æ¸²æŸ“
- âœ… **å›¾è¡¨æ¸²æŸ“**ï¼šä½¿ç”¨ `Mermaid.js` æ¸²æŸ“æµç¨‹å›¾ã€æ—¶åºå›¾ç­‰
- âœ… **å›¾ç‰‡ç®¡ç†**ï¼šæŒ‰æ–‡ç«  Slug ç»„ç»‡ï¼Œå›¾ç‰‡ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨
- âœ… **SEO ä¼˜åŒ–**ï¼šè‡ªåŠ¨ç”Ÿæˆ meta æ ‡ç­¾ã€sitemap.xml
- âœ… **å“åº”å¼è®¾è®¡**ï¼šé€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šåŒæ­¥åˆ é™¤å·²ç§»é™¤æ–‡ç« çš„ç”Ÿæˆæ–‡ä»¶

---

## 2. æŠ€æœ¯æ ˆ

### åç«¯æ„å»ºå·¥å…·
- **Python 3.x**
  - `PyYAML`ï¼šè§£æ Frontmatter
  - `os`, `json`, `subprocess`ï¼šæ–‡ä»¶å¤„ç†å’Œç³»ç»Ÿè°ƒç”¨

### å‰ç«¯æŠ€æœ¯
- **åŸç”Ÿ HTML5 / CSS3 / JavaScript (ES6+)**
- **Markdown è§£æ**ï¼š[marked.js](https://marked.js.org/)
- **ä»£ç é«˜äº®**ï¼š[highlight.js](https://highlightjs.org/)
- **æ•°å­¦æ¸²æŸ“**ï¼š[KaTeX](https://katex.org/)
- **å›¾è¡¨æ¸²æŸ“**ï¼š[Mermaid.js](https://mermaid.js.org/) - æ”¯æŒæµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰
- **å­—ä½“**ï¼šGoogle Fonts (Outfit, JetBrains Mono)

### éƒ¨ç½²å¹³å°
- **GitHub Pages**
- **GitHub Actions**ï¼šè‡ªåŠ¨åŒ– CI/CD

---

## 3. ç›®å½•ç»“æ„

```plaintext
/Users/kaze/Documents/yukari502.github.io/
â”‚
â”œâ”€â”€ Articles/                          # [æºæ–‡ä»¶] Markdown æ–‡ç« æºç 
â”‚   â”œâ”€â”€ Category1/                     # å¯é€‰çš„åˆ†ç±»æ–‡ä»¶å¤¹
â”‚   â”‚   â””â”€â”€ article-name.md            # æ–‡ç« æ–‡ä»¶
â”‚   â””â”€â”€ article-name.md                # æ ¹ç›®å½•æ–‡ç« 
â”‚
â”œâ”€â”€ Pic/                               # [èµ„æº] å›¾ç‰‡å­˜å‚¨ç›®å½•
â”‚   â””â”€â”€ {article-slug}/                # æ¯ç¯‡æ–‡ç« çš„å›¾ç‰‡æ–‡ä»¶å¤¹ï¼ˆä»¥ Slug å‘½åï¼‰
â”‚       â”œâ”€â”€ image1.png
â”‚       â””â”€â”€ image2.jpg
â”‚
â”œâ”€â”€ posts/                             # [ç”Ÿæˆç‰©] é™æ€ HTML æ–‡ç« é¡µé¢
â”‚   â”œâ”€â”€ {category}/                    # æŒ‰åˆ†ç±»å­˜æ”¾
â”‚   â”‚   â””â”€â”€ article-slug.html
â”‚   â””â”€â”€ uncategorized/                 # æœªåˆ†ç±»æ–‡ç« 
â”‚       â””â”€â”€ article-slug.html
â”‚
â”œâ”€â”€ Index/                             # [ç”Ÿæˆç‰©] JSON ç´¢å¼•æ•°æ®
â”‚   â”œâ”€â”€ index.json                     # ä¸»ç´¢å¼•ï¼ˆåŒ…å«å¹´ä»½åˆ—è¡¨ï¼‰
â”‚   â””â”€â”€ index_{year}.json              # æŒ‰å¹´ä»½åˆ†ç‰‡çš„ç´¢å¼•
â”‚
â”œâ”€â”€ articles.json                      # [ç”Ÿæˆç‰©] æ‰€æœ‰æ–‡ç« çš„æ±‡æ€»ï¼ˆå‘åå…¼å®¹ï¼‰
â”‚
â”œâ”€â”€ generate_articles_json.py          # [æ„å»ºè„šæœ¬] æ­¥éª¤1ï¼šè§£æ Markdownï¼Œç”Ÿæˆç´¢å¼•
â”œâ”€â”€ generate_article_pages.py          # [æ„å»ºè„šæœ¬] æ­¥éª¤2ï¼šç”Ÿæˆ HTML é¡µé¢
â”œâ”€â”€ generate_sitemap.py                # [æ„å»ºè„šæœ¬] æ­¥éª¤3ï¼šç”Ÿæˆ sitemap.xml
â”œâ”€â”€ cleanup_posts.py                   # [ç»´æŠ¤è„šæœ¬] æ¸…ç†å·²åˆ é™¤æ–‡ç« çš„å­¤ç«‹HTMLæ–‡ä»¶
â”‚
â”œâ”€â”€ article-template.html              # [æ¨¡æ¿] æ–‡ç« é¡µé¢çš„ HTML æ¨¡æ¿
â”œâ”€â”€ index.html                         # [å…¥å£] ç½‘ç«™ä¸»é¡µï¼ˆSPA æ¨¡å¼ï¼‰
â”œâ”€â”€ script.js                          # [é€»è¾‘] æ ¸å¿ƒå‰ç«¯è„šæœ¬
â”œâ”€â”€ style.css                          # [æ ·å¼] å…¨å±€æ ·å¼è¡¨
â”‚
â”œâ”€â”€ .github/workflows/static.yml       # [CI/CD] GitHub Actions é…ç½®
â”œâ”€â”€ sitemap.xml                        # [SEO] ç½‘ç«™åœ°å›¾
â”œâ”€â”€ pinned-articles.json               # [é…ç½®] ç½®é¡¶æ–‡ç« åˆ—è¡¨
â””â”€â”€ PROJECT_TOPOLOGY.md                # [æ–‡æ¡£] æœ¬æ–‡æ¡£
```

---

## 4. å·¥ä½œæµç¨‹

### 4.1 å†…å®¹åˆ›ä½œæµç¨‹

```mermaid
graph LR
    A[å†™ä½œ Markdown] --> B[æ·»åŠ  Frontmatter]
    B --> C[ä¿å­˜åˆ° Articles/]
    C --> D[æ”¾ç½®å›¾ç‰‡åˆ° Pic/slug/]
    D --> E[æäº¤åˆ° Git]
    E --> F[æ¨é€åˆ° GitHub]
```

**è¯¦ç»†æ­¥éª¤**ï¼š

1. **åˆ›å»ºæ–‡ç« **
   - åœ¨ `Articles/` ç›®å½•ä¸‹åˆ›å»º `.md` æ–‡ä»¶
   - å¯é€‰æ‹©æ”¾å…¥åˆ†ç±»æ–‡ä»¶å¤¹ï¼ˆå¦‚ `Articles/Tech/article.md`ï¼‰

2. **ç¼–å†™ Frontmatter**
   ```yaml
   ---
   title: æ–‡ç« æ ‡é¢˜
   date: 2025-11-22
   description: æ–‡ç« æ‘˜è¦ï¼ˆç”¨äº SEOï¼‰
   category: æŠ€æœ¯
   tags: [Python, Webå¼€å‘]
   ---
   ```

3. **æ·»åŠ å›¾ç‰‡**
   - åˆ›å»ºæ–‡ä»¶å¤¹ï¼š`Pic/{article-slug}/`
   - å°†å›¾ç‰‡æ”¾å…¥æ­¤æ–‡ä»¶å¤¹
   - Markdown ä¸­ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨ï¼š`![æè¿°](/Pic/article-slug/image.png)`
   - æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨ä»¥ `/Pic/` å¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œä¸å†æ”¯æŒç›¸å¯¹è·¯å¾„è‡ªåŠ¨è½¬æ¢ã€‚

4. **æäº¤å¹¶æ¨é€**
   ```bash
   git add .
   git commit -m "Add new article"
   git push
   ```

### 4.2 è‡ªåŠ¨æ„å»ºæµç¨‹

```mermaid
graph TD
    A[Git Push] --> B[è§¦å‘ GitHub Actions]
    B --> C[æ£€å‡ºä»£ç ]
    C --> D[å®‰è£… Python ä¾èµ–]
    D --> E[è¿è¡Œ generate_articles_json.py]
    E --> F[è¿è¡Œ generate_article_pages.py]
    F --> G[è¿è¡Œ generate_sitemap.py]
    G --> J[è¿è¡Œ cleanup_posts.py]
    J --> H[æäº¤ç”Ÿæˆçš„æ–‡ä»¶]
    H --> I[éƒ¨ç½²åˆ° GitHub Pages]
```

**è¯¦ç»†æ­¥éª¤**ï¼š

1. **ç¯å¢ƒå‡†å¤‡**ï¼ˆGitHub Actions è‡ªåŠ¨æ‰§è¡Œï¼‰
   - å®‰è£… Python 3.x
   - å®‰è£… `PyYAML` ä¾èµ–

2. **ç”Ÿæˆç´¢å¼•** (`generate_articles_json.py`)
   - æ‰«æ `Articles/` ç›®å½•
   - è§£ææ¯ä¸ª `.md` æ–‡ä»¶çš„ Frontmatter
   - é€šè¿‡ `git log` è·å–æ–‡ä»¶æ—¶é—´æˆ³
   - ç”Ÿæˆ `articles.json` å’Œ `Index/` ç›®å½•ä¸‹çš„åˆ†ç‰‡ç´¢å¼•

3. **ç”Ÿæˆ HTML** (`generate_article_pages.py`)
   - è¯»å– `articles.json`
   - è¯»å– `article-template.html` æ¨¡æ¿
   - æ›¿æ¢æ¨¡æ¿ä¸­çš„å ä½ç¬¦ï¼ˆ`{TITLE}`, `{CONTENT}` ç­‰ï¼‰
   - è¾“å‡ºé™æ€ HTML åˆ° `posts/` ç›®å½•

4. **ç”Ÿæˆ Sitemap** (`generate_sitemap.py`)
   - æ”¶é›†æ‰€æœ‰æ–‡ç«  URL
   - ç”Ÿæˆ `sitemap.xml`

5. **éƒ¨ç½²**
   - æäº¤ç”Ÿæˆçš„æ–‡ä»¶åˆ° Git
   - GitHub Pages è‡ªåŠ¨éƒ¨ç½²

### 4.3 è¿è¡Œæ—¶æ¸²æŸ“æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—®æ–‡ç« é¡µ] --> B{æ£€æµ‹é¡µé¢ç±»å‹}
    B -->|ä¸»é¡µ| C[initSPA]
    B -->|æ–‡ç« é¡µ| D[initStaticArticle]
    D --> E[è¯»å–åµŒå…¥çš„ Markdown]
    E --> F[é…ç½® marked.js renderer]
    F --> G[è§£æ Markdown]
    G --> H[æ¸²æŸ“å›¾ç‰‡]
    H --> I[é«˜äº®ä»£ç ]
    I --> J[æ¸²æŸ“æ•°å­¦å…¬å¼]
    J --> K[æ˜¾ç¤ºå†…å®¹]
```

---

## 5. æ ¸å¿ƒè„šæœ¬ä¸é…ç½®è¯¦è§£

### 5.1 `generate_articles_json.py`

**ä½œç”¨**ï¼šæ‰«æ Markdown æ–‡ä»¶ï¼Œæå–å…ƒæ•°æ®ï¼Œç”Ÿæˆ JSON ç´¢å¼•ã€‚

#### å…³é”®å‡½æ•°

##### `parse_frontmatter(content)`
```python
def parse_frontmatter(content):
    """
    ä» Markdown å†…å®¹ä¸­æå– YAML Frontmatter
    
    å‚æ•°:
        content (str): Markdown æ–‡ä»¶å†…å®¹
    
    è¿”å›:
        tuple: (frontmatter_dict, body_content)
    """
```
- **ä½œç”¨**ï¼šåˆ†ç¦» Frontmatter å’Œæ­£æ–‡
- **è§£æå™¨**ï¼šä½¿ç”¨ `PyYAML`
- **æ ¼å¼**ï¼šæ”¯æŒ YAML æ ¼å¼ï¼ˆ`---` åˆ†éš”ï¼‰

##### `get_file_dates(filepath)`
```python
def get_file_dates(filepath):
    """
    é€šè¿‡ Git æ—¥å¿—è·å–æ–‡ä»¶çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´
    
    å‚æ•°:
        filepath (str): æ–‡ä»¶è·¯å¾„
    
    è¿”å›:
        dict: {'created': '2025-11-22', 'modified': '2025-11-22'}
    """
```
- **ä¼˜ç‚¹**ï¼šè‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ—¶é—´æˆ³
- **å›é€€**ï¼šå¦‚æœ Git ä¸å¯ç”¨ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ—¶é—´

##### `slugify(text)`
```python
def slugify(text):
    """
    å°†æ–‡ç« æ ‡é¢˜è½¬æ¢ä¸º URL å‹å¥½çš„ Slug
    
    ç¤ºä¾‹: "Hello World!" -> "hello-world"
    """
```
- **è§„åˆ™**ï¼š
  - è½¬å°å†™
  - ç§»é™¤ç‰¹æ®Šå­—ç¬¦
  - ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦ï¼ˆ`-`ï¼‰
  - ä¸­æ–‡ä¿æŒåŸæ ·ï¼ˆURL ç¼–ç ï¼‰

#### è¾“å‡ºæ–‡ä»¶ç»“æ„

**`Index/index.json`**:
```json
{
  "updated": "2025-11-22 21:02:26",
  "years": ["2025", "2024"]
}
```

**`Index/index_2025.json`**:
```json
{
  "year": "2025",
  "articles": [
    {
      "title": "æ–‡ç« æ ‡é¢˜",
      "description": "æ–‡ç« æ‘˜è¦",
      "path": "Articles/article.md",
      "date": "2025-11-22",
      "category": "æŠ€æœ¯",
      "slug": "article-slug",
      "url": "/posts/category/article-slug.html"
    }
  ]
}
```

---

### 5.2 `generate_article_pages.py`

**ä½œç”¨**ï¼šæ ¹æ®ç´¢å¼•å’Œæ¨¡æ¿ç”Ÿæˆé™æ€ HTML é¡µé¢ã€‚

#### å…³é”®å‡½æ•°

##### `generate_article_html(article, template_content, base_url, output_dir)`
```python
def generate_article_html(article, template_content, base_url, output_dir):
    """
    ä¸ºå•ç¯‡æ–‡ç« ç”Ÿæˆ HTML é¡µé¢
    
    å‚æ•°:
        article (dict): æ–‡ç« å…ƒæ•°æ®
        template_content (str): HTML æ¨¡æ¿å†…å®¹
        base_url (str): ç½‘ç«™åŸºç¡€ URL
        output_dir (str): è¾“å‡ºç›®å½•
    
    è¿”å›:
        str: ç”Ÿæˆçš„ HTML æ–‡ä»¶è·¯å¾„
    """
```

#### æ¨¡æ¿å ä½ç¬¦

| å ä½ç¬¦ | æ¥æº | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `{TITLE}` | `article['title']` | "Daily-Bio-Arxiv" |
| `{DESCRIPTION}` | `article['description']` | "æ–‡ç« æ‘˜è¦..." |
| `{KEYWORDS}` | `category + title` | "æŠ€æœ¯, Daily-Bio-Arxiv" |
| `{URL}` | `base_url + url` | "https://yukari502.github.io/posts/..." |
| `{DATE}` | `article['date']` | "2025-11-22" |
| `{CATEGORY}` | `article['category']` | "Uncategorized" |
| `{CONTENT}` | æ–‡ä»¶å†…å®¹ï¼ˆè½¬ä¹‰åï¼‰ | Markdown æºç  |
| `{SLUG}` | `article['slug']` | "daily-bio-arxiv" |
| `{ROOT_PATH}` | è®¡ç®—çš„ç›¸å¯¹è·¯å¾„ | "../../" |

#### å…³é”®é€»è¾‘

**1. HTML å®‰å…¨è½¬ä¹‰**
```python
replacements = {
    '{TITLE}': html.escape(article['title']),
    '{DESCRIPTION}': html.escape(article.get('description', '')[:160]),
    # ...
}
```
- **ç›®çš„**ï¼šé˜²æ­¢ XSS æ”»å‡»
- **æ–¹æ³•**ï¼šä½¿ç”¨ `html.escape()` è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

**2. Script æ ‡ç­¾ä¿æŠ¤**
```python
'{CONTENT}': markdown_content.replace('</script>', '<\\/script>')
```
- **é—®é¢˜**ï¼šMarkdown ä¸­çš„ `</script>` ä¼šæå‰å…³é—­ `<script>` æ ‡ç­¾
- **è§£å†³**ï¼šè½¬ä¹‰ä¸º `<\\/script>`

**3. ç›¸å¯¹è·¯å¾„è®¡ç®—**
```python
# è®¡ç®—ä»æ–‡ç« ç›®å½•åˆ°é¡¹ç›®æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
relative_root = os.path.relpath('.', article_output_dir)
# posts/uncategorized/article.html -> "../../"
```
- **ç›®çš„**ï¼šæ”¯æŒæœ¬åœ°æ–‡ä»¶è®¿é—®å’Œ GitHub Pages éƒ¨ç½²
- **åº”ç”¨**ï¼šåŠ è½½ `style.css`, `script.js`, å›¾ç‰‡èµ„æº

---

### 5.3 `generate_sitemap.py`

**ä½œç”¨**ï¼šç”Ÿæˆ SEO å‹å¥½çš„ `sitemap.xml`ã€‚

#### è¾“å‡ºæ ¼å¼
```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://yukari502.github.io/posts/uncategorized/article.html</loc>
    <lastmod>2025-11-22</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.8</priority>
  </url>
</urlset>

```

---

### 5.4 `cleanup_posts.py`

**ä½œç”¨**ï¼šåŒæ­¥æ¸…ç† `posts/` ç›®å½•ï¼Œåˆ é™¤å·²åœ¨ `Articles/` ä¸­ç§»é™¤çš„æ–‡ç« å¯¹åº”çš„ HTML æ–‡ä»¶ã€‚

#### å…³é”®é€»è¾‘

1. **è¯»å–ç´¢å¼•**ï¼šåŠ è½½ `articles.json` è·å–å½“å‰æ‰€æœ‰æœ‰æ•ˆçš„æ–‡ç« è·¯å¾„ã€‚
2. **æ‰«ææ–‡ä»¶**ï¼šéå† `posts/` ç›®å½•ä¸‹çš„æ‰€æœ‰ `.html` æ–‡ä»¶ã€‚
3. **æ¯”å¯¹ä¸åˆ é™¤**ï¼š
   - è®¡ç®—æ¯ä¸ª HTML æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€‚
   - è‹¥è·¯å¾„ä¸åœ¨æœ‰æ•ˆåˆ—è¡¨ä¸­ï¼Œåˆ™è§†ä¸ºå­¤ç«‹æ–‡ä»¶å¹¶åˆ é™¤ã€‚
4. **æ¸…ç†ç©ºç›®å½•**ï¼šé€’å½’åˆ é™¤æ¸…ç†åå˜ä¸ºç©ºçš„åˆ†ç±»æ–‡ä»¶å¤¹ã€‚

#### ä½¿ç”¨æ–¹å¼

**æœ¬åœ°è¿è¡Œ**ï¼š
```bash
python3 cleanup_posts.py
```

**CI é›†æˆ**ï¼š
å·²é›†æˆåˆ° GitHub Actions å·¥ä½œæµä¸­ï¼Œåœ¨ç”Ÿæˆæ–°é¡µé¢åè‡ªåŠ¨æ‰§è¡Œã€‚


---

### 5.5 é…ç½®æ–‡ä»¶ï¼š`pinned-articles.json`

**ä½œç”¨**ï¼šå®šä¹‰åœ¨é¦–é¡µç½®é¡¶æ˜¾ç¤ºçš„æ–‡ç« åˆ—è¡¨ã€‚

**æ ¼å¼**ï¼šJSON æ•°ç»„ï¼ŒåŒ…å«æ–‡ç« çš„ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰ã€‚

**ç¤ºä¾‹**ï¼š
```json
[
  "Articles/daily-bio-arxiv.md",
  "Articles/Another-Article.md"
]
```

**æ³¨æ„**ï¼š
- è·¯å¾„å¿…é¡»ä¸ `articles.json` ä¸­çš„ `path` å­—æ®µå®Œå…¨åŒ¹é…ï¼ˆé€šå¸¸æ˜¯ `Articles/filename.md`ï¼‰ã€‚
- å‰ç«¯è„šæœ¬ (`script.js`) ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œå¹¶æ ¹æ®è·¯å¾„ç­›é€‰å‡ºå¯¹åº”çš„æ–‡ç« å¯¹è±¡ï¼Œä¼˜å…ˆå±•ç¤ºåœ¨é¦–é¡µé¡¶éƒ¨ã€‚
- å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©ºæ•°ç»„ï¼Œç½®é¡¶åŒºåŸŸå°†è‡ªåŠ¨éšè—æˆ–æ˜¾ç¤ºæ— å†…å®¹æç¤ºã€‚

---

## 6. å‰ç«¯æ¶æ„

### 6.1 `script.js` æ ¸å¿ƒé€»è¾‘

#### æ¨¡å¼æ£€æµ‹
```javascript
document.addEventListener('DOMContentLoaded', () => {
    const markdownSource = document.getElementById('markdown-source');
    
    if (markdownSource) {
        initStaticArticle();  // æ–‡ç« é¡µæ¨¡å¼
    } else {
        initSPA();            // ä¸»é¡µ SPA æ¨¡å¼
    }
});
```

---

### 6.2 é™æ€æ–‡ç« æ¨¡å¼ (`initStaticArticle`)

#### æ‰§è¡Œæµç¨‹

1. **åˆå§‹åŒ–ä¸»é¢˜**
   ```javascript
   const savedTheme = localStorage.getItem('theme') || 'dark';
   document.documentElement.setAttribute('data-theme', savedTheme);
   ```

2. **è¯»å–å…ƒæ•°æ®**
   ```javascript
   const articleSlugMeta = document.querySelector('meta[name="article-slug"]');
   const articleSlug = articleSlugMeta ? articleSlugMeta.content : '';
   
   const rootPathMeta = document.querySelector('meta[name="root-path"]');
   const rootPath = rootPathMeta ? rootPathMeta.content : '/';
   ```

3. **é…ç½® Marked.js Renderer**

   **ä»£ç æ¸²æŸ“å™¨** (`renderer.code`)
   ```javascript
   renderer.code = function (code, language) {
       // ç±»å‹æ£€æŸ¥å’Œè½¬æ¢
       code = String(code || '');
       
       // å¤„ç†å¯¹è±¡ç±»å‹çš„ code (marked.js æœ‰æ—¶ä¼šä¼ é€’ token)
       if (typeof code === 'object' && code !== null) {
           code = code.text || code.raw || '';
       }
       
       // æ£€æŸ¥ highlight.js æ˜¯å¦åŠ è½½
       if (typeof hljs === 'undefined') {
           return `<pre><code>${code}</code></pre>`;
       }
       
       // é«˜äº®ä»£ç 
       const highlighted = hljs.highlight(code, { language }).value;
       
       // è¿”å›è‡ªå®šä¹‰ HTMLï¼ˆmacOS é£æ ¼çª—å£ï¼‰
       return `
       <div class="code-window">
           <div class="window-header">
               <div class="window-controls">
                   <span class="dot red"></span>
                   <span class="dot yellow"></span>
                   <span class="dot green"></span>
               </div>
               <div class="window-title">${language.toUpperCase()}</div>
               <button class="copy-btn" onclick="copyCode(this)">...</button>
           </div>
           <pre><code class="hljs ${language}">${highlighted}</code></pre>
       </div>`;
   };
   ```

   **å›¾ç‰‡æ¸²æŸ“å™¨** (`renderer.image`) - **æ ¸å¿ƒä¿®å¤ç‚¹**
   ```javascript
   renderer.image = function (href, title, text) {
       // âš ï¸ å…³é”®ä¿®å¤ï¼šå¤„ç† marked.js ä¼ é€’çš„å¯¹è±¡
       if (typeof href === 'object' && href !== null) {
           href = href.href || href.raw || '';
       }
       
       // ç¡®ä¿ href æ˜¯å­—ç¬¦ä¸²
       href = String(href || '');
       if (!href) return '';
       
       // å¤„ç†ç›¸å¯¹è·¯å¾„
       if (!href.startsWith('http') && !href.startsWith('/') && !href.startsWith('data:')) {
           // æç¤ºï¼šç°åœ¨æ¨èä½¿ç”¨ç»å¯¹è·¯å¾„ /Pic/...
           // ç›¸å¯¹è·¯å¾„ä¸å†è‡ªåŠ¨è½¬æ¢ä¸º Pic/{slug}/...
       }
       
       // è½¬ä¹‰ HTML ç‰¹æ®Šå­—ç¬¦
       const safeText = String(text || '').replace(/"/g, '&quot;');
       const safeTitle = String(title || '').replace(/"/g, '&quot;');
       
       return `<img src="${href}" alt="${safeText}" title="${safeTitle}" class="img-fluid">`;
   };
   ```

4. **è§£æ Markdown**
   ```javascript
   const htmlContent = marked.parse(markdownSource.textContent, { renderer });
   contentDiv.innerHTML = htmlContent;
   ```

5. **æ¸²æŸ“æ•°å­¦å…¬å¼**
   ```javascript
   if (window.renderMathInElement) {
       renderMathInElement(contentDiv, {
           delimiters: [
               { left: '$$', right: '$$', display: true },
               { left: '$', right: '$', display: false }
           ]
       });
   }
   ```

---

### 6.3 SPA æ¨¡å¼ (`initSPA`)

ç”¨äºä¸»é¡µ (`index.html`) çš„å•é¡µåº”ç”¨é€»è¾‘ï¼š

#### åŠŸèƒ½æ¨¡å—

1. **æ–‡ç« åˆ—è¡¨åŠ è½½**
   ```javascript
   async function fetchArticles() {
       // ä¼˜å…ˆåŠ è½½åˆ†ç‰‡ç´¢å¼•
       const response = await fetch('Index/index.json');
       const mainIndex = await response.json();
       
       for (const year of mainIndex.years) {
           const yearData = await fetch(`Index/index_${year}.json`);
           articles.push(...yearData.articles);
       }
       
       return articles.sort((a, b) => new Date(b.date) - new Date(a.date));
   }
   ```

2. **æœç´¢åŠŸèƒ½**
   ```javascript
   searchInput.addEventListener('input', (e) => {
       const query = e.target.value.toLowerCase();
       const filtered = allArticles.filter(article =>
           article.title.toLowerCase().includes(query) ||
           article.description.toLowerCase().includes(query)
       );
       renderArticles(filtered);
   });
   ```

3. **åˆ†ç±»å¯¼èˆª**
   - è‡ªåŠ¨æå–æ‰€æœ‰åˆ†ç±»
   - å¯æŠ˜å çš„åˆ†ç±»æ ‘
   - ç‚¹å‡»æ–‡ç« è·³è½¬åˆ°é™æ€é¡µé¢

---

## 7. å›¾ç‰‡è·¯å¾„è§£ææœºåˆ¶

### 7.1 è·¯å¾„è§„èŒƒ

- **Markdown å¼•ç”¨**ï¼š`![æè¿°](/Pic/article-slug/image.png)`
- **å®é™…ä½ç½®**ï¼š`/Pic/article-slug/image.png`
- **è§„åˆ™**ï¼šå¿…é¡»ä½¿ç”¨ä»¥ `/Pic/` å¼€å¤´çš„ç»å¯¹è·¯å¾„ã€‚

### 7.2 è·¯å¾„ç¤ºä¾‹

| Markdown è·¯å¾„ | è¯´æ˜ |
|--------------|-----------|
| `/Pic/article-slug/image.png` | âœ… æ­£ç¡®ï¼ˆç»å¯¹è·¯å¾„ï¼‰ |
| `image.png` | âŒ é”™è¯¯ï¼ˆä¸å†æ”¯æŒç›¸å¯¹è·¯å¾„ï¼‰ |
| `Pic/article-slug/image.png` | âŒ é”™è¯¯ï¼ˆç¼ºå°‘å¼€å¤´çš„ /ï¼‰ |
| `https://example.com/img.png` | âœ… æ­£ç¡®ï¼ˆå¤–éƒ¨é“¾æ¥ï¼‰ |

---

## 8. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 8.1 å›¾ç‰‡æ— æ³•æ˜¾ç¤º

#### ç—‡çŠ¶

- æ–‡ç« é¡µæ˜¾ç¤º "Error rendering content"
- æ§åˆ¶å°é”™è¯¯ï¼š`TypeError: href.startsWith is not a function`

#### æ ¹æœ¬åŸå› 

`marked.js` æœ‰æ—¶ä¼ é€’**å¯¹è±¡ï¼ˆtokenï¼‰**è€Œéå­—ç¬¦ä¸²ç»™ `renderer.image`ã€‚

#### è§£å†³æ–¹æ¡ˆï¼ˆå·²ä¿®å¤ï¼‰

```javascript
// åœ¨ renderer.image å¼€å¤´æ·»åŠ ç±»å‹æ£€æŸ¥
if (typeof href === 'object' && href !== null) {
    href = href.href || href.raw || '';
}
href = String(href || '');
```
 
 ---
 
### 8.2 ä»£ç å—æ˜¾ç¤ºä¸º `[object Object]`

#### æ ¹æœ¬åŸå› 

åŒä¸Šï¼Œ`marked.js` ä¼ é€’å¯¹è±¡ç»™ `renderer.code`ã€‚

#### è§£å†³æ–¹æ¡ˆ

```javascript
renderer.code = function (code, language) {
    code = String(code || '');
    if (typeof code === 'object' && code !== null) {
        code = code.text || code.raw || '';
    }
    // ...
};
```

---

### 8.3 Frontmatter è§£æå¤±è´¥

#### ç—‡çŠ¶
æ–‡ç« ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºé»˜è®¤æ ‡é¢˜ã€‚

#### å¯èƒ½åŸå› 
1. Frontmatter æ ¼å¼é”™è¯¯ï¼ˆYAML è¯­æ³•ï¼‰
2. ç¼ºå°‘é—­åˆçš„ `---`
3. æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®

#### æ­£ç¡®æ ¼å¼
```yaml
---
title: æ–‡ç« æ ‡é¢˜
date: 2025-11-22
description: ç®€çŸ­æ‘˜è¦
category: åˆ†ç±»å
---
```

---

### 8.4 GitHub Actions æ„å»ºå¤±è´¥

#### å¸¸è§åŸå› 
1. **ç¼ºå°‘ä¾èµ–**ï¼šæ£€æŸ¥ `PyYAML` æ˜¯å¦å®‰è£…
2. **Git é…ç½®é”™è¯¯**ï¼šç¡®ä¿æœ‰æƒé™æäº¤
3. **æ–‡ä»¶è·¯å¾„é—®é¢˜**ï¼šWindows/Linux è·¯å¾„å·®å¼‚

#### è°ƒè¯•æ–¹æ³•
æŸ¥çœ‹ GitHub Actions æ—¥å¿—ï¼š
```
Repository -> Actions -> ç‚¹å‡»å¤±è´¥çš„ workflow -> æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```

---

## 9. ç»´æŠ¤æŒ‡å—

### 9.1 æ·»åŠ æ–°æ–‡ç« 

```bash
# 1. åˆ›å»º Markdown æ–‡ä»¶
vim Articles/new-article.md

# 2. æ·»åŠ  Frontmatter
# ï¼ˆå‚è€ƒ 8.3 èŠ‚ï¼‰

# 3. åˆ›å»ºå›¾ç‰‡æ–‡ä»¶å¤¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
mkdir Pic/new-article

# 4. æäº¤å¹¶æ¨é€
git add .
git commit -m "Add new article: new-article"
git push
```

### 9.2 æœ¬åœ°æµ‹è¯•

```bash
# 1. ç”Ÿæˆç´¢å¼•å’Œé¡µé¢
python3 generate_articles_json.py
python3 generate_article_pages.py

# 2. åœ¨æµè§ˆå™¨æ‰“å¼€
open posts/category/article-slug.html
```

### 9.3 ä¿®æ”¹æ ·å¼

- **å…¨å±€æ ·å¼**ï¼šç¼–è¾‘ `style.css`
- **æ–‡ç« é¡µæ ·å¼**ï¼šç¼–è¾‘ `article-template.html` ä¸­çš„ `<style>` æ ‡ç­¾
- **ä»£ç å—æ ·å¼**ï¼šä¿®æ”¹ `script.js` ä¸­çš„ `renderer.code` è¿”å›çš„ HTML

### 9.4 æ›´æ–°ä¾èµ–

```bash
# æ£€æŸ¥ Python ä¾èµ–
pip list | grep PyYAML

# å‰ç«¯åº“ï¼ˆé€šè¿‡ CDNï¼Œæ— éœ€æœ¬åœ°å®‰è£…ï¼‰
# å¦‚éœ€æ›´æ–°ç‰ˆæœ¬ï¼Œä¿®æ”¹ HTML ä¸­çš„ CDN é“¾æ¥
```

### 9.5 è°ƒè¯•æŠ€å·§

#### å‰ç«¯é”™è¯¯
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹ Console æ ‡ç­¾
3. æ£€æŸ¥ Network æ ‡ç­¾ï¼ˆèµ„æºåŠ è½½ï¼‰

#### åç«¯é”™è¯¯
1. æŸ¥çœ‹ GitHub Actions æ—¥å¿—
2. æœ¬åœ°è¿è¡Œ Python è„šæœ¬ï¼Œè§‚å¯Ÿè¾“å‡º

#### å›¾ç‰‡é—®é¢˜
1. æ£€æŸ¥ `Pic/` ç›®å½•ç»“æ„
2. éªŒè¯ `article-slug` æ˜¯å¦åŒ¹é…æ–‡ä»¶å¤¹å
3. æŸ¥çœ‹æµè§ˆå™¨ Network æ ‡ç­¾ï¼Œç¡®è®¤è¯·æ±‚çš„è·¯å¾„

---

## 10. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 10.1 å·²å®ç°
- âœ… åˆ†ç‰‡ç´¢å¼•ï¼ˆæŒ‰å¹´ä»½ï¼‰
- âœ… å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆå‡è½»æœåŠ¡å™¨å‹åŠ›ï¼‰
- âœ… CDN åŠ è½½ç¬¬ä¸‰æ–¹åº“

### 10.2 å¯é€‰ä¼˜åŒ–
- å›¾ç‰‡å‹ç¼©ï¼ˆä½¿ç”¨ TinyPNG ç­‰å·¥å…·ï¼‰
- æ‡’åŠ è½½å›¾ç‰‡ï¼ˆæ·»åŠ  `loading="lazy"` å±æ€§ï¼‰
- ä»£ç åˆ†å‰²ï¼ˆåˆ†ç¦» SPA å’Œæ–‡ç« é¡µ JSï¼‰

---

## 11. å®‰å…¨æ³¨æ„äº‹é¡¹

### 11.1 å·²å®æ–½
- âœ… HTML è½¬ä¹‰ï¼ˆ`html.escape()`ï¼‰
- âœ… Script æ ‡ç­¾ä¿æŠ¤ï¼ˆè½¬ä¹‰ `</script>`ï¼‰
- âœ… HTTPSï¼ˆGitHub Pages å¼ºåˆ¶ï¼‰

### 11.2 å»ºè®®
- å®šæœŸæ›´æ–°ç¬¬ä¸‰æ–¹åº“ï¼ˆmarked.js, highlight.jsï¼‰
- ä¸åœ¨ Markdown ä¸­åµŒå…¥ç”¨æˆ·è¾“å…¥
- æ£€æŸ¥ GitHub Actions secrets å®‰å…¨æ€§

---

## 12. å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤
```bash
# å®Œæ•´æ„å»ºæµç¨‹
python3 generate_articles_json.py && \
python3 generate_article_pages.py && \
python3 generate_sitemap.py

# æäº¤å¹¶éƒ¨ç½²
git add . && git commit -m "Update" && git push

# å¼ºåˆ¶æ¨é€ï¼ˆæ…ç”¨ï¼‰
git push origin main --force
```

### é‡è¦æ–‡ä»¶è·¯å¾„
- **æ–‡ç« æ¨¡æ¿**ï¼š`article-template.html`
- **ä¸»é¡µ**ï¼š`index.html`
- **æ ¸å¿ƒè„šæœ¬**ï¼š`script.js`
- **å…¨å±€æ ·å¼**ï¼š`style.css`
- **CI/CD é…ç½®**ï¼š`.github/workflows/static.yml`

---

**æœ€åæ›´æ–°**ï¼š2025-11-22  
**ç»´æŠ¤è€…**ï¼šYukari502 & Gemini 3.0 pro
**ç‰ˆæœ¬**ï¼šv2.1
